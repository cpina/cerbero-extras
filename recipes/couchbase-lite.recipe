# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python

class Recipe(recipe.Recipe):
    name = 'Couchbase.Lite'
    version = '1.0.4'
    licenses = [License.Apachev2]
    stype = SourceType.GIT
    btype = BuildType.CUSTOM
    deps = ['mono', 'Newtonsoft.Json']
    remotes = {'github': 'https://github.com/fluendo/Couchbase.Lite-net.git'}
    commit = 'github/mono'
    files_cli = [
      'lib/cli/Couchbase.Lite-1.0/Couchbase.Lite.dll',
      'lib/cli/Couchbase.Lite-1.0/SQLitePCL.raw.dll',
      'lib/cli/Couchbase.Lite-1.0/SQLitePCL.ugly.dll'
    ]

    def compile(self):
        shell.call('xbuild src/Couchbase.Lite.sln /target:Couchbase_Lite_Mono',
            self.build_dir)

    def install(self):
        destdir = os.path.join(self.config.prefix, 'lib/cli/Couchbase.Lite-1.0')
        if not os.path.exists(destdir):
            os.makedirs(destdir)
        shell.call('cp src/Couchbase.Lite.Mono/bin/Release/*.dll %s' % destdir,
            self.build_dir)
